(function(a,b,c,d,e,f,g,h){if(!(e=a.jQuery)||c>e.fn.jquery||d(e)){f=b.createElement('script');f.type='text/javascript';f.src='//ajax.googleapis.com/ajax/libs/jquery/'+c+'/jquery.min.js';f.onload=f.onreadystatechange=function(){if(!g&&(!(h=this.readyState)||h=='loaded'||h=='complete')){d((e=a.jQuery).noConflict(1),g=1);e(f).remove();}};var i=b.documentElement.childNodes,j;for(nodeidx in i){j=i[nodeidx].nodeName.toLowerCase();if(['head','body'].indexOf(j)>-1){i[nodeidx].appendChild(f);break;}}}})(window,document,'1.9.1',function(a,b){'$:nomunge, L:nomunge';var c=(function(){var b=Object.toJSON?Object.toJSON:JSON.stringify;function c(){var c={};try{var g=a('#__citelet_testid').attr('data-testid');c.testid=g;}catch(h){}c.url=window.location.href;c.publisher=e.detect();if(c.publisher!==''){head_ref=d.extract(publisher);cited_refs=f.extract(publisher);var i=a.when(head_ref,cited_refs).pipe(function(a,d){c.head_ref=Object.keys(a).length?b(a):'';c.cited_refs=d.length?b(d):'';return c;});return i;}else return a.when(c);}function g(b,c){var d={url:'http://citelet.herokuapp.com/sendrefs/',data:b,success:function(a){console.log(a.msg);}};if(typeof c!=='undefined')a.extend(d,c);a.ajax(d);}return{scrape:c,send:g};})();var d=(function(){function b(a,c){this.extract=c;if(typeof a!=='undefined')b.registry[a]=this;}b.registry={};function c(c,d,e){if(typeof d==='undefined')var d=/DC\.|citation_(?!reference)/i;if(typeof e==='undefined')var e=/DC\.|citation_/i;var f=function(){var b={},c;a('meta[name][content]').filter(function(){return d.test(this.name);}).each(function(){c=this.name.replace(e,'');if(!(c in b))b[c]=[];b[c].push(this.content);});return b;};b.call(this,c,f);};c.prototype=new b();c.prototype.constructor=c;new b('sciencedirect',function(){var b={};var c=a('a#ddDoi');var d=c.attr('href');d=d.replace(/.*?dx\.doi\.org.*?\//,'');b.doi=d;var e=a('.svTitle').text();if(e)b.article_title=e;var f=/go to (.*?) on sciverse sciencedirect/i.exec(document.documentElement.innerHTML);if(f)b.journal_title=f[1];var g=a('.authorName');if(g.length>0)b.authors=g.map(function(){return this.outerHTML;}).get();return b;});new b('springer',function(){var b={};var c=a('div.ContextInformation');c.children('span').each(function(){key=this.className.replace(/article/i,'');val=this.innerText;b[key]=val;});b.authors=a('span.AuthorName').map(function(){return this.innerText;}).get();return b;});new b('ovid',function(){var b={};var c=a('div.fulltext-SOURCEFULL').text();var d;if(c)b.Title=c;a('div#fulltext-source-info div').each(function(){d=this.innerText.split(':');if(d.length>1)b[d[0]]=d[1];});return b;});new b('apa',function(){var b=a('.citation-wrapping-div dt, .short-citation dt'),c=a('.citation-wrapping-div dd, .short-citation dd');var d={};for(var e=0;e<b.length;e++){var f=b[e].innerHTML.replace(/^:|:$/g,''),g=c[e].innerHTML;d[f]=g;}return d;});new c('highwire');new c('wiley');new c('tandf');new c('biomed');new c('thieme');new c('pubmed');new c('royal');new c('nas');new c('mit');new c('frontiers');new c('hindawi');new c('nature');new c('ama');new c('acs');new c('lww',/wkhealth_/i,/wkhealth_/i);function d(a){if(!(a in b.registry))return false;return b.registry[a].extract();};return{HeadExtractor:b,MetaHeadExtractor:c,extract:d};})();var e=(function(){function b(a,c){this.detect=c;if(typeof a!=='undefined')b.registry[a]=this;};b.registry={};function c(c,d){function e(){return d.test(a('title').text());};b.call(this,c,e);};c.prototype=new b();c.prototype.constructor=c;function d(c,d,e){if(typeof e==='undefined')e=['='];function f(){var b='meta',c;a.each(d,function(a,d){c=e[a%e.length];b=b+'['+d[0]+c+'"'+d[1]+'"]';});return a(b).length>0;};b.call(this,c,f);};d.prototype=new b();d.prototype.constructor=d;function e(c,d,e,f){if(typeof f==='undefined')f='i';function g(){var b=a(d);a.each(e,function(c,d){function e(){var b=false;a(this.attributes).each(function(){if(RegExp(d[0],f).test(this.nodeName)&RegExp(d[1],f).test(this.nodeValue)){b=true;return false;}});return b;}b=b.filter(e);});return b.length>0;}b.call(this,c,g);};e.prototype=new b();e.prototype.constructor=e;new b('apa',function(){var b=a('dt').filter(function(){return this.innerHTML=='Publisher:';});if(b.length>0){var c=b.next('dd');if(/american psychological association/i.test(c.text()))return true;}var d=a('p.body-paragraph').filter(function(){return /source:/i.test(this.innerText);});if(/american psychological association/i.test(d.text()))return true;;return false;});new b('lww',function(){return a('a').filter(function(){return /Lippincott Williams & Wilkins/.test(this.innerText);}).length>0;});new c('sciencedirect',/sciencedirect/i);new c('springer',/springer/i);new c('wiley',/wiley online library/i);new d('highwire',[['name','HW.ad-path']]);new d('tandf',[['property','og:site_name'],['content','Taylor and Francis']]);new d('biomed',[['name','citation_publisher'],['content','BioMed Central Ltd']]);new d('thieme',[['name','citation_publisher'],['content','Thieme Medical Publishers']]);new d('pubmed',[['name','ncbi_db'],['content','pmc']]);new d('royal',[['name','DC.Publisher'],['content','The Royal Society']]);new d('nas',[['name','citation_publisher'],['content','National Acad Sciences']]);new d('ovid',[['name','Ovid']],['^=']);new d('frontiers',[['name','citation_publisher'],['content','Frontiers']]);new d('hindawi',[['name','citation_publisher'],['content','Hindawi Publishing Corporation']]);new d('ama',[['name','citation_publisher'],['content','American Medical Association']]);new d('acs',[['name','dc.Publisher'],['content','American Chemical Society']]);new e('mit','meta',[['name','dc.publisher'],['content','mit press']]);new e('nature','meta',[['name','dc.publisher'],['content','nature publishing group']]);function f(){for(publisher in b.registry)if(b.registry[publisher].detect())return publisher;return '';}return{PublisherDetector:b,TitlePublisherDetector:c,MetaPublisherDetector:d,detect:f};})();var f=(function(){function b(a,c){this.extract=c;if(typeof a!=='undefined')b.registry[a]=this;};b.registry={};function c(c,d){fun=function(){return a(d);};b.call(this,c,fun);}c.prototype=new b();c.prototype.constructor=c;new b('sciencedirect',function(){function b(){var b=a('a.intra_ref').filter(function(){return /ancb.*?b\d+/.test(a(this).attr('id'));}).map(function(){return a(this).attr('href');});b=a.unique(b);var c,d=true;a.each(b,function(b,e){c=a('.label').filter(function(){return a(this).attr('href')==e;});if(c.length==0){d=false;return false;}});return d;}if(b())return a('ul.reference');var c=a.Deferred(),d=a([]);tryidx=1;var e=window.setInterval(function(){if(b()){c.resolve(a('ul.reference'));window.clearInterval(e);}if(tryidx>=20){c.resolve(d);window.clearInterval(e);}tryidx+=1;},500);return c;});new b('thieme',function(){return a(a('.literaturliste')[0]).children('li').filter(function(){return a(this).find('h3').length==0;});});new b('pubmed',function(){var b=a('li[id^="B"]'),c=a('div.ref-cit-blk');return b.length?b:c;});new b('apa',function(){var b=a('a[title="References"][href="#toc"]');if(b.length==0)return false;ref_span=b.parent('span');if(ref_span.length==0)return false;var c=ref_span.nextAll('p.body-paragraph');return c.filter(function(){return(!/this publication is protected/i.test(this.innerHTML))&&(!/submitted.*?revised.*?accepted/i.test(this.innerHTML));});});new c('springer','#abstract-references li, div.Citation');new c('highwire','ol.cit-list > li');new c('wiley','ul.plain > li');new c('tandf','ul.references > li');new c('biomed','ol#references > li');new c('royal','ol.cit-list > li');new c('nas','ol.cit-list > li');new c('mit','td.refnumber + td');new c('ovid','p.fulltext-REFERENCES');new c('frontiers','div.References');new c('hindawi','ol > li[id^="B"]');new c('nature','ol.references > li');new c('ama','div.referenceSection div.refRow');new c('acs','div.NLM_citation');new c('lww','#ej-article-references div[id^=P]');function d(c){if(!(c in b.registry))return false;var d=b.registry[c].extract();d=a.when(d);return d.pipe(function(b){return b.map(function(){return a(this).html();}).get();});};return{ReferenceExtractor:b,SelectorReferenceExtractor:c,extract:d};})();new e.MetaPublisherDetector('plos',[['name','citation_publisher'],['content','Public Library of Science']]);new d.MetaHeadExtractor('plos');new f.SelectorReferenceExtractor('plos','ol.references > li');var g=c.scrape();g.done(function(a){c.send(a);});});
