(function(a,b,c,d,e,f,g,h){if(!(e=a.jQuery)||c>e.fn.jquery||d(e)){f=b.createElement('script');f.type='text/javascript';f.src='//ajax.googleapis.com/ajax/libs/jquery/'+c+'/jquery.min.js';f.onload=f.onreadystatechange=function(){if(!g&&(!(h=this.readyState)||h=='loaded'||h=='complete')){d((e=a.jQuery).noConflict(1),g=1);e(f).remove();}};var i=b.documentElement.childNodes,j;for(nodeidx in i){j=i[nodeidx].nodeName.toLowerCase();if(['head','body'].indexOf(j)>-1){i[nodeidx].appendChild(f);break;}}}})(window,document,'1.9.1',function(a,b){'$:nomunge, L:nomunge';var c=(function(b){function c(a,b){this.extract=b;if(typeof a!=='undefined')c.registry[a]=this;}c.registry={};function d(b,d,e){if(typeof d==='undefined')var d=/DC\.|citation_(?!reference)/i;if(typeof e==='undefined')var e=/DC\.|citation_/i;var f=function(){var b={},c;a('meta[name][content]').filter(function(){return d.test(this.name);}).each(function(){c=this.name.replace(e,'').toLowerCase();if(!(c in b))b[c]=[];b[c].push(this.content);});return b;};c.call(this,b,f);};d.prototype=new c();d.prototype.constructor=d;function e(a){if(!(a in c.registry))return false;return c.registry[a].extract();};return{CitationExtractor:c,MetaCitationExtractor:d,extract:e};})();var d=d||{};d.citation=c;var e=(function(){var b=Object.toJSON?Object.toJSON:JSON.stringify;function c(a){if(typeof a==='object')return Object.keys(a).length>0;return a==false;};function e(){var e={};try{var f=a('#__citelet_testid').attr('data-testid');e.testid=f;}catch(h){}e.url=window.location.href;e.publisher=g.detect();if(e.publisher!==''){var i=Object.keys(d);var j=a.map(i,function(a,b){return d[a].extract(publisher);});var k=a.when.apply(a,j).pipe(function(){var d=arguments;a.each(i,function(a,f){e[f]=c(d[a])?b(d[a]):'';});return e;});return k;}else return a.when(e);}function f(c,d,e){var f=a.extend(c,{meta:b(d)});var g={url:'http://localhost:5000/sendrefs/',type:'POST',data:f,success:function(a){console.log(a.msg);}};if(typeof e!=='undefined')a.extend(g,e);a.ajax(g);}return{scrape:e,send:f};})();var f=(function(a){email_rgx=/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:\w(?:[\w-]*\w)?\.)+\w(?:[\w-]*\w)?/g;function b(){return this.getAttribute('href').replace(/^mailto:/i,'').replace(/\(\W+\)$/,'').trim();}function c(a,b){this.extract=b;if(typeof a!=='undefined')c.registry[a]=this;};c.registry={};function d(a){if(!(a in c.registry))return false;return c.registry[a].extract();};return{email_rgx:email_rgx,clean_addr:b,ContactExtractor:c,extract:d};})();var d=d||{};d.contacts=f;var c=(function(b){function c(a,b){this.extract=b;if(typeof a!=='undefined')c.registry[a]=this;}c.registry={};function d(b,d,e){if(typeof d==='undefined')var d=/DC\.|citation_(?!reference)/i;if(typeof e==='undefined')var e=/DC\.|citation_/i;var f=function(){var b={},c;a('meta[name][content]').filter(function(){return d.test(this.name);}).each(function(){c=this.name.replace(e,'').toLowerCase();if(!(c in b))b[c]=[];b[c].push(this.content);});return b;};c.call(this,b,f);};d.prototype=new c();d.prototype.constructor=d;function e(a){if(!(a in c.registry))return false;return c.registry[a].extract();};return{CitationExtractor:c,MetaCitationExtractor:d,extract:e};})();var d=d||{};d.citation=c;var g=(function(){function b(a,c){this.detect=c;if(typeof a!=='undefined')b.registry[a]=this;};b.registry={};function c(c,d){function e(){return d.test(a('title').text());};b.call(this,c,e);};c.prototype=new b();c.prototype.constructor=c;function d(c,d,e){if(typeof e==='undefined')e=['='];function f(){var b='meta',c;a.each(d,function(a,d){c=e[a%e.length];b=b+'['+d[0]+c+'"'+d[1]+'"]';});return a(b).length>0;};b.call(this,c,f);};d.prototype=new b();d.prototype.constructor=d;function e(c,d,e,f){if(typeof f==='undefined')f='i';function g(){var b=a(d);a.each(e,function(c,d){function e(){var b=false;a(this.attributes).each(function(){if(RegExp(d[0],f).test(this.nodeName)&RegExp(d[1],f).test(this.nodeValue)){b=true;return false;}});return b;}b=b.filter(e);});return b.length>0;}b.call(this,c,g);};e.prototype=new b();e.prototype.constructor=e;function f(){for(publisher in b.registry)if(b.registry[publisher].detect())return publisher;return '';}return{PublisherDetector:b,TitlePublisherDetector:c,MetaPublisherDetector:d,RegexPublisherDetector:e,detect:f};})();var h=(function(b){function c(a,b){this.extract=b;if(typeof a!=='undefined')c.registry[a]=this;};c.registry={};function d(b,d){fun=function(){return a(d);};c.call(this,b,fun);}d.prototype=new c();d.prototype.constructor=d;function e(b){if(!(b in c.registry))return false;var d=c.registry[b].extract();d=a.when(d);return d.pipe(function(b){return a(b).map(function(){if(this.hasOwnProperty('outerHTML'))return this.outerHTML;return this;}).get();});};return{ReferenceExtractor:c,SelectorReferenceExtractor:d,extract:e};})();var d=d||{};d.references=h;new g.MetaPublisherDetector('acs',[['name','dc.Publisher'],['content','American Chemical Society']]);new c.MetaCitationExtractor('acs');new h.SelectorReferenceExtractor('acs','div.NLM_citation');new g.MetaPublisherDetector('ama',[['name','citation_publisher'],['content','American Medical Association']]);new c.MetaCitationExtractor('ama');new h.SelectorReferenceExtractor('ama','div.referenceSection div.refRow');new g.PublisherDetector('apa',function(){var b=a('dt').filter(function(){return this.innerHTML=='Publisher:';});if(b.length>0){var c=b.next('dd');if(/american psychological association/i.test(c.text()))return true;}var d=a('p.body-paragraph').filter(function(){return /source:/i.test(this.innerText);});if(/american psychological association/i.test(d.text()))return true;;return false;});new c.CitationExtractor('apa',function(){var b=a('.citation-wrapping-div dt, .short-citation dt'),c=a('.citation-wrapping-div dd, .short-citation dd');var d={};for(var e=0;e<b.length;e++){var f=b[e].innerHTML.replace(/^:|:$/g,''),g=c[e].innerHTML;d[f]=g;}return d;});new h.ReferenceExtractor('apa',function(){var b=a('a[title="References"][href="#toc"]');if(b.length==0)return false;ref_span=b.parent('span');if(ref_span.length==0)return false;var c=ref_span.nextAll('p.body-paragraph');return c.filter(function(){return(!/this publication is protected/i.test(this.innerHTML))&&(!/submitted.*?revised.*?accepted/i.test(this.innerHTML));});});new g.MetaPublisherDetector('biomed',[['name','citation_publisher'],['content','BioMed Central Ltd']]);new c.MetaCitationExtractor('biomed');new h.SelectorReferenceExtractor('biomed','ol#references > li');new g.MetaPublisherDetector('frontiers',[['name','citation_publisher'],['content','Frontiers']]);new c.MetaCitationExtractor('frontiers');new h.SelectorReferenceExtractor('frontiers','div.References');new f.ContactExtractor('frontiers',function(){var b={};b.email=a('div.AbstractSummary').text().match(email_rgx);return b;});new g.MetaPublisherDetector('highwire',[['name','HW.ad-path']]);new c.MetaCitationExtractor('highwire');new h.SelectorReferenceExtractor('highwire','ol.cit-list > li');new f.ContactExtractor('highwire',function(){var b={};b.email=a('li.corresp a[href]').map(f.clean_addr).get();return b;});new g.MetaPublisherDetector('hindawi',[['name','citation_publisher'],['content','Hindawi Publishing Corporation']]);new c.MetaCitationExtractor('hindawi');new h.SelectorReferenceExtractor('hindawi','ol > li[id^="B"]');new g.PublisherDetector('lww',function(){return a('a').filter(function(){return /Lippincott Williams & Wilkins/.test(this.innerText);}).length>0;});new c.MetaCitationExtractor('lww',/wkhealth_/i,/wkhealth_/i);new h.SelectorReferenceExtractor('lww','#ej-article-references div[id^=P]');new g.RegexPublisherDetector('mit','meta',[['name','dc.publisher'],['content','mit press']]);new c.MetaCitationExtractor('mit');new h.SelectorReferenceExtractor('mit','td.refnumber + td');new g.RegexPublisherDetector('nature','meta',[['name','dc.publisher'],['content','nature publishing group']]);new c.MetaCitationExtractor('nature');new h.SelectorReferenceExtractor('nature','ol.references > li, div#References li');new g.MetaPublisherDetector('ovid',[['name','Ovid']],['^=']);new c.CitationExtractor('ovid',function(){var b={};var c=a('div.fulltext-SOURCEFULL').text();var d;if(c)b.Title=c;a('div#fulltext-source-info div').each(function(){d=this.innerText.split(':');if(d.length>1)b[d[0]]=d[1];});return b;});new h.SelectorReferenceExtractor('ovid','p.fulltext-REFERENCES');new g.MetaPublisherDetector('plos',[['name','citation_publisher'],['content','Public Library of Science']]);new c.MetaCitationExtractor('plos');new h.ReferenceExtractor('plos',function(){var b=a('ol.references > li'),c=a('meta[name="citation_reference"]');if(b.length!=c.length)return b;var d=[];for(var e=0;e<b.length;e++)d[e]=b[e].outerHTML+c[e].outerHTML;return d;});new f.ContactExtractor('plos',function(){var b={};b.email=a.unique(a('div.author_meta a[href]').map(f.clean_addr).get());return b;});new g.MetaPublisherDetector('pubmed',[['name','ncbi_db'],['content','pmc']]);new c.MetaCitationExtractor('pubmed');new h.ReferenceExtractor('pubmed',function(){var b=a('li[id^="B"]'),c=a('div.ref-cit-blk');return b.length?b:c;});new f.ContactExtractor('pubmed',function(){var b={};b.email=a('ul.authorGroup img').parent('a').map(f.clean_addr).get();return b;});new g.TitlePublisherDetector('sciencedirect',/sciencedirect/i);new c.CitationExtractor('sciencedirect',function(){var b={};var c=a('a#ddDoi');var d=c.attr('href');d=d.replace(/.*?dx\.doi\.org.*?\//,'');b.doi=d;var e=a('.svTitle').text();if(e)b.article_title=e;var f=/go to (.*?) on sciverse sciencedirect/i.exec(document.documentElement.innerHTML);if(f)b.journal_title=f[1];var g=a('.authorName');if(g.length>0)b.authors=g.map(function(){return this.outerHTML;}).get();return b;});new h.ReferenceExtractor('sciencedirect',function(){function b(){var b=a('a.intra_ref').filter(function(){return /ancb.*?b\d+/.test(a(this).attr('id'));}).map(function(){return a(this).attr('href');});b=a.unique(b);var c,d=true;a.each(b,function(b,e){c=a('.label').filter(function(){return a(this).attr('href')==e;});if(c.length==0){d=false;return false;}});return d;}if(b())return a('ul.reference');var c=a.Deferred(),d=a([]);tryidx=1;var e=window.setInterval(function(){if(b()){c.resolve(a('ul.reference'));window.clearInterval(e);}if(tryidx>=20){c.resolve(d);window.clearInterval(e);}tryidx+=1;},500);return c;});new f.ContactExtractor('sciencedirect',function(){var b={};b.email=a('ul.authorGroup img').parent('a').map(f.clean_addr).get();return b;});new g.TitlePublisherDetector('springer',/springer/i);new c.CitationExtractor('springer',function(){var b={};var c=a('div.ContextInformation');c.children('span').each(function(){key=this.className.replace(/article/i,'');val=this.innerText;b[key]=val;});b.authors=a('span.AuthorName').map(function(){return this.innerText;}).get();return b;});new h.SelectorReferenceExtractor('springer','#abstract-references li, div.Citation');new g.MetaPublisherDetector('tandf',[['property','og:site_name'],['content','Taylor and Francis']]);new c.MetaCitationExtractor('tandf');new h.SelectorReferenceExtractor('tandf','ul.references > li');new g.MetaPublisherDetector('thieme',[['name','citation_publisher'],['content','Thieme Medical Publishers']]);new c.MetaCitationExtractor('thieme');new h.ReferenceExtractor('thieme',function(){return a(a('.literaturliste')[0]).children('li').filter(function(){return a(this).find('h3').length==0;});});new g.TitlePublisherDetector('wiley',/wiley online library/i);new c.MetaCitationExtractor('wiley');new h.SelectorReferenceExtractor('wiley','ul.plain > li');new f.ContactExtractor('wiley',function(){var b={};b.email=a('div#authorsDetail').text().match(f.email_rgx);return b;});var i=e.scrape();i.done(function(a){e.send(a,{source:'bookmarklet'});});});
